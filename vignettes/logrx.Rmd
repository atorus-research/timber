---
title: "logrxpackage"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{logrxpackage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
library(logrx)
```

The purpose of the `logrx` package is to generate a log upon execution of 
an R script which enables traceability and reproducibility of the executed code. 


# Log attributes
The following attributes are recorded in the log:

* `metadata`: `logrx` package information
   + Version of the package
   + Type of build
   + Link to the GitHub repository
* `user and file information`
   + User that generated the log
   + Name and path of the script for which the log was generated
* `hash_sum`:  A unique sha1 is created for the log file
* `session_info`: The R session information
   + R version
   + OS and system
   + GUI
   + Language and timezone
* `packages`: List of all available packages in the environment
* `external_software`: List of all external software
* `masked_functions`: List of all functions masked by packages
* `start_time`, `end_time`, and `run_time`: Start, end, and run times
* `used_packages_functions`: List of all packages and functions used in the 
script for which the log was generated
* `unapproved_packages_functions`: List of all packages and functions used in 
the script for which the log was generated that are not part of the approved 
list of packages and functions
* `errors`: Errors generated when running the script
* `messages`: Messages generated when running the script
* `warnings`: Warnings generated when running the script
* `result`: Result generated when running the script
* `output`: Output generated when running the script
* `log_name`, `log_path`: Name and path of the log


<style>
  .scrolled {
    overflow-y: scroll !important;
    white-space: nowrap;
    max-height: 400px;
  }
</style>

<div class = "scrolled">
 <img src='`r here::here("man/figures/log.png")`'/>
</div>

# Generating a log
The log can be generated according in two ways:

* Using the `axecute()` function

* Using the `log_*()` functions


## `axecute()`
`axecute()` enables the command line submission of a program. A log is 
set-up around the program, and its code is run safely and loudly (using 
`safely()` from the `purrr` package).
```{r axecute, eval = FALSE}
axecute("my_script.R")
```


## `log_*()` functions
Use the `log_*()` functions:

* `log_init()` to initialise the log.rx environment

* `log_config()` to initialise the log.rx environment, add its attributes, and 
set them

* `run_safely_loudly()` to execute the program code, and capture errors, 
warnings, messages, output, and result

* `log_write()` to get and format the content of the log.rx before writing it 
to a log file

* `log_remove()` to remove the log.rx object by setting `options("log.rx")` to 
NULL
```{r log_*, eval = FALSE}
log_config("my_script.R")
run_safely_loudly("my_script.R")
log_write()
```

# Scripting with ```logrx```
While ```logrx``` is built around creating a log for a program it can just as 
easily be used when running an entire set of programs.  The `axecute()` 
function has been built with both single file execution and scripted file 
execution in mind.  With the use of simple functions such as `lapply()` 
scripting is easy.  Below is some sample code of how `lapply()` can be used 
with `axecute()`.

```{r scripting, eval = FALSE}
lapply(c("file.R", "otherfile.R"), axecute)
```

If your scripting needs to work on the contents of a directory instead of a 
pre-defined list, functions such as `list.files` can be used to obtain a list 
of files to use.  Below is an example of how this can be applied in practice by 
getting all files ending in '.R' in the current working directory using a 
regular expression, and then using `lapply()` to run the files using 
`axecute()`.

```{r scripting-dir, eval = FALSE}
r_script_list <- list.files(path = ".", pattern = "\\.R$")
lapply(r_script_list, axecute)
```

